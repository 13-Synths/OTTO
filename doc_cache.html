<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>cache.hpp</title>
</head>
<body>
<article id="standardese-cache.hpp" class="standardese-file-documentation">
<h1 class="standardese-file-documentation-heading">Header file <code>cache.hpp</code></h1>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="pre">#include</span> <span class="pre">&lt;</span><span class="typ dec var fun">functional</span><span class="pre">&gt;</span>

<span class="pre">#include</span> <span class="pre">&quot;</span><span class="typ dec var fun">util&#x2F;type_traits.hpp</span><span class="pre">&quot;</span>

<span class="kwd">namespace</span> <span class="typ dec var fun">otto</span>
<span class="pun">{</span>
    <span class="kwd">namespace</span> <span class="typ dec var fun">util</span>
    <span class="pun">{</span>
        <span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">T</span><span class="pun">&gt;</span>
        <span class="kwd">struct</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E"><span class="typ dec var fun">cache_base</span></a><span class="pun">;</span>

        <span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">T</span><span class="pun">&gt;</span>
        <span class="kwd">struct</span> <a href="doc_cache.html#standardese-otto::util::cached%3CT%3E"><span class="typ dec var fun">cached</span></a><span class="pun">;</span>
    <span class="pun">}</span>
<span class="pun">}</span>
</code></pre>
<section id="standardese-otto" class="standardese-entity-documentation">
<section id="standardese-otto::util" class="standardese-entity-documentation">
<section id="standardese-otto::util::cache_base&lt;T&gt;" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Struct <code>otto::util::cache_base</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">T</span><span class="pun">&gt;</span>
<span class="kwd">struct</span> <span class="typ dec var fun">cache_base</span>
<span class="pun">{</span>
    <span class="kwd">void</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E::invalidate()"><span class="typ dec var fun">invalidate</span></a><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>

    <span class="kwd">bool</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E::valid()const"><span class="typ dec var fun">valid</span></a><span class="pun">(</span><span class="pun">)</span> <span class="kwd">const</span><span class="pun">;</span>

    <span class="typ dec var fun">T</span> <span class="kwd">const</span><span class="pun">&amp;</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E::value()"><span class="typ dec var fun">value</span></a><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>

    <span class="typ dec var fun">T</span> <span class="kwd">const</span><span class="pun">*</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E::operator-%3E()"><span class="typ dec var fun">operator-&gt;</span></a><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>

    <span class="typ dec var fun">T</span> <span class="kwd">const</span><span class="pun">&amp;</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E::operator*()"><span class="typ dec var fun">operator*</span></a><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>

<span class="kwd">protected</span><span class="pun">:</span>
    <span class="kwd">virtual</span> <span class="kwd">void</span> <a href="doc_cache.html#standardese-otto::util::cache_base%3CT%3E::refresh()"><span class="typ dec var fun">refresh</span></a><span class="pun">(</span><span class="pun">)</span> <span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span>

    <span class="kwd">bool</span> <span class="typ dec var fun">_valid</span> <span class="pun">=</span> <span class="typ dec var fun">false</span><span class="pun">;</span>
<span class="pun">};</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;-brief" class="standardese-brief-section">A CRTP style cache base class.</p>
<dl id="standardese-otto::util::cache_base&lt;T&gt;-inline-sections" class="standardese-inline-sections">
<dt>Requires:</dt>
<dd><code>T</code> shall be <code>DefaultConstructible</code></dd>
</dl>
<p>The cached value is imutable, and lazilly refreshed.
This wrapper is not thread safe at invalidation!</p>
<section id="standardese-otto::util::cache_base&lt;T&gt;::invalidate()" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>invalidate</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="kwd">void</span> <span class="typ dec var fun">invalidate</span><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;::invalidate()-brief" class="standardese-brief-section">Invalidate the cache</p>
</section>
<hr class="standardese-entity-documentation-break" />
<section id="standardese-otto::util::cache_base&lt;T&gt;::valid()const" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>valid</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="kwd">bool</span> <span class="typ dec var fun">valid</span><span class="pun">(</span><span class="pun">)</span> <span class="kwd">const</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;::valid()const-brief" class="standardese-brief-section">Check if the cache is valid</p>
</section>
<hr class="standardese-entity-documentation-break" />
<section id="standardese-otto::util::cache_base&lt;T&gt;::value()" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>value</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="typ dec var fun">T</span> <span class="kwd">const</span><span class="pun">&amp;</span> <span class="typ dec var fun">value</span><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;::value()-brief" class="standardese-brief-section">Access the cached value</p>
</section>
<hr class="standardese-entity-documentation-break" />
<section id="standardese-otto::util::cache_base&lt;T&gt;::operator-&gt;()" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>operator-&gt;</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="typ dec var fun">T</span> <span class="kwd">const</span><span class="pun">*</span> <span class="typ dec var fun">operator-&gt;</span><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;::operator-&gt;()-brief" class="standardese-brief-section">Access the cached value</p>
<p>Alias to <code>value()</code></p>
</section>
<hr class="standardese-entity-documentation-break" />
<section id="standardese-otto::util::cache_base&lt;T&gt;::operator*()" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>operator*</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="typ dec var fun">T</span> <span class="kwd">const</span><span class="pun">&amp;</span> <span class="typ dec var fun">operator*</span><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;::operator*()-brief" class="standardese-brief-section">Access the cached value</p>
<p>Alias to <code>value()</code></p>
</section>
<hr class="standardese-entity-documentation-break" />
<section id="standardese-otto::util::cache_base&lt;T&gt;::refresh()" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>refresh</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="kwd">virtual</span> <span class="kwd">void</span> <span class="typ dec var fun">refresh</span><span class="pun">(</span><span class="pun">)</span> <span class="pun">=</span> <span class="lit">0</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cache_base&lt;T&gt;::refresh()-brief" class="standardese-brief-section">Refresh the cache</p>
<p>It should be implemented in the derived class, and it is called by
<code>value()</code> when the cache is invalid</p>
</section>
<hr class="standardese-entity-documentation-break" />
</section>
<hr class="standardese-entity-documentation-break" />
<section id="standardese-otto::util::cached&lt;T&gt;" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Struct <code>otto::util::cached</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">T</span><span class="pun">&gt;</span>
<span class="kwd">struct</span> <span class="typ dec var fun">cached</span>
<span class="pun">:</span> <span class="typ dec var fun">cache_base&lt;T&gt;</span>
<span class="pun">{</span>
    <span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">FuncRef</span><span class="pun">&gt;</span>
    <span class="typ dec var fun">cached</span><span class="pun">(</span><span class="typ dec var fun">FuncRef</span><span class="pun">&amp;&amp;</span> <span class="typ dec var fun">f</span><span class="pun">)</span><span class="pun">;</span>

<span class="kwd">private</span><span class="pun">:</span>
    <span class="kwd">virtual</span> <span class="kwd">void</span> <span class="typ dec var fun">refresh</span><span class="pun">(</span><span class="pun">)</span><span class="pun">;</span>

    <span class="typ dec var fun">std::function</span><span class="pun">&lt;</span>void (T &amp;)<span class="pun">&gt;</span> <span class="typ dec var fun">generator</span><span class="pun">;</span>

    <span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">Fr</span><span class="pun">&gt;</span>
    <span class="kwd">static</span> <span class="kwd">auto</span> <a href="doc_cache.html#standardese-otto::util::cached%3CT%3E::make_generator%3CFr%3E(Fr&amp;&amp;)"><span class="typ dec var fun">make_generator</span></a><span class="pun">(</span><span class="typ dec var fun">Fr</span><span class="pun">&amp;&amp;</span> <span class="typ dec var fun">fr</span><span class="pun">)</span><span class="pun">;</span>
<span class="pun">};</span>
</code></pre>
<p id="standardese-otto::util::cached&lt;T&gt;-brief" class="standardese-brief-section">A simple wrapper for invalidatable caches.</p>
<dl id="standardese-otto::util::cached&lt;T&gt;-inline-sections" class="standardese-inline-sections">
<dt>Requires:</dt>
<dd><code>T</code> shall be <code>DefaultConstructible</code></dd>
</dl>
<p>If you are writing a separate struct to contain the cache data, use
<code>cache_base</code> instead.</p>
<p>The cached value is imutable, and lazilly refreshed.
This wrapper is not thread safe at invalidation!</p>
<p>It is constructed with a generator function, which can take two forms:</p>
<ol>
<li>
<p><code>void(T&amp; cache)</code>, which is expected to update the <code>cache</code> parameter
it is supplied with.</p>
</li>
<li>
<p><code>T()</code>, which will return the new value.</p>
</li>
</ol>
<p>Both can be very useful in different contexts.</p>
<section id="standardese-otto::util::cached&lt;T&gt;::make_generator&lt;Fr&gt;(Fr&amp;&amp;)" class="standardese-entity-documentation">
<h3 class="standardese-entity-documentation-heading">Function <code>make_generator</code></h3>
<pre><code class="standardese-language-cpp standardese-entity-synopsis"><span class="kwd">template</span> <span class="pun">&lt;</span><span class="kwd">typename</span> <span class="typ dec var fun">Fr</span><span class="pun">&gt;</span>
<span class="kwd">static</span> <span class="kwd">auto</span> <span class="typ dec var fun">make_generator</span><span class="pun">(</span><span class="typ dec var fun">Fr</span><span class="pun">&amp;&amp;</span> <span class="typ dec var fun">fr</span><span class="pun">)</span><span class="pun">;</span>
</code></pre>
<p id="standardese-otto::util::cached&lt;T&gt;::make_generator&lt;Fr&gt;(Fr&amp;&amp;)-brief" class="standardese-brief-section">Creates the apropriate generator function from the two valid signatures</p>
<p>Used in the constructor</p>
</section>
<hr class="standardese-entity-documentation-break" />
</section>
<hr class="standardese-entity-documentation-break" />
</section>
</section>
</article>
</body>
</html>
